# **FRONTEND ARCHITECTURE DOCUMENTATION**

**Project Name:** ChatNation CRM Admin Console
**Tech Stack:** Next.js 16 (App Router), TypeScript, Tailwind CSS
**Design System:** Shadcn UI (Radix Primitives)

## **1. HIGH-LEVEL OVERVIEW**

The Frontend is divided into **4 "Workspaces"**, mirroring the backend modules.
It uses **Client-Side Rendering (CSR)** heavily for the interactive builders (Surveys, HypeCards) and **Server-Side Rendering (SSR)** for dashboards and data tables to ensure performance and SEO (where relevant for public pages).

### **Core UI Principles**

  * **"What You See Is What You Get" (WYSIWYG):** The HypeCard editor must look *exactly* like the final image generated by the Python backend.
  * **Optimistic Updates:** When an admin drags a survey question to a new spot, it snaps instantly before the API confirms.
  * **Real-Time Data:** Poll results and event heatmaps update live without page refreshes.

-----

## **2. TECHNOLOGY STACK (FRONTEND)**

| Category | Technology | Justification |
| :--- | :--- | :--- |
| **Framework** | **Next.js 16 (App Router)** | Standard for modern React. Allows easy separation of Server/Client logic. |
| **Language** | **TypeScript** | Strict typing is mandatory for the complex data structures of Surveys and HypeCard templates. |
| **Styling** | **Tailwind CSS** | Utility-first CSS. Essential for the "HypeCard Renderer" to match backend logic easily. |
| **Components** | **Shadcn UI** | Accessible, copy-paste components. We don't fight the library; we own the code. |
| **State (Server)** | **TanStack Query (React Query)** | Caching, polling (for live analytics), and managing loading states. |
| **State (Global)** | **Zustand** | Lightweight global state for the "Builders" (e.g., holding the current Survey structure while editing). |
| **Forms** | **React Hook Form + Zod** | Validation schemas. Zod schemas here will match the Pydantic models in the Python Backend. |
| **Drag & Drop** | **`dnd-kit`** | Modern, accessible DnD library. Critical for the Survey Builder. |
| **Visuals** | **Recharts** | Composable charts for analytics. |
| **Maps** | **React Leaflet** | For Event Booth Maps and Heatmaps. |

-----

## **3. MODULE-SPECIFIC ARCHITECTURES**

### **A. THE SURVEY BUILDER (Module II)**

*Complexity Level: High*

This is a full **Drag-and-Drop Form Builder** (similar to Typeform's admin).

  * **State Management:**
      * We do NOT use local React state here. We use **Zustand**.
      * Why? The "Properties Panel" (right sidebar) needs to edit the "Question Card" (main view) which is deeply nested. Prop-drilling would be a nightmare.
  * **Component Structure:**
      * `SurveyCanvas`: The main drop zone using `dnd-kit` (SortableContext).
      * `QuestionNode`: A draggable item representing a question.
      * `PropertiesPanel`: A form that changes based on the *selected* node ID.
      * `LogicEditor`: A visual line-drawer (using SVG lines) connecting options to jump destinations (e.g., "If Yes -\> Go to Q3").

**Workflow:**

1.  User drags "Text Input" from Sidebar to Canvas.
2.  Zustand store adds a new node to the `questions` array.
3.  User clicks the node. `activeQuestionId` is set in Zustand.
4.  Right Sidebar renders the settings for "Text Input".
5.  On Save, the entire JSON structure is validated via Zod and sent to the FastAPI backend.

### **B. THE HYPECARD STUDIO (Module IV)**

*Complexity Level: High*

This is a **Visual Template Designer**.

  * **The "Parity" Problem:** The Python backend uses Playwright to screenshot HTML. The Frontend must render the *exact same HTML*.

  * **Solution: Shared CSS Logic.**

      * We create a shared component: `<HypeCardRenderer data={templateConfig} />`.
      * This component uses Tailwind classes.
      * In the **Studio**, this component is wrapped in a resizable container.
      * In the **Backend**, this *exact same HTML structure* is generated by the Python script (or Python injects JSON into a headless React page).

  * **UI Layout:**

      * **Canvas (Center):** Shows the live preview of the card.
      * **Layers (Left):** Background, Logo, Text, QR Code.
      * **Design Tools (Right):** Font selector, Color picker, Positioning (X/Y coordinates).

  * **Interactivity:**

      * Uses **Moveable** or **React-Draggable** to allow admins to drag the "Name Placeholder" around the card.
      * As they drag, the X/Y coordinates update in the configuration state.

### **C. THE ANALYTICS DASHBOARD**

*Complexity Level: Medium*

  * **Data Fetching Strategy:**
      * **Static Reports:** (e.g., "Yesterday's Sales") -\> Fetch once on mount.
      * **Live Event Mode:** (e.g., "Current Booth Traffic") -\> Use **TanStack Query** with `refetchInterval: 5000` (polling every 5s).
  * **Visualization:**
      * **Heatmaps:** Uses `react-leaflet-heatmap-layer`. It takes X/Y coordinates from the backend (booth visits) and overlays a gradient on the venue map image.
      * **Charts:** Recharts for "Messages per Hour" (Line Chart) and "Sentiment Analysis" (Pie Chart).

-----

## **4. THE APPLICATION SHELL (LAYOUT)**

The App Router structure ensures security and efficient loading.

```
/app
  /(auth)               # Public Login/Register pages
    /login
    /register
  /(dashboard)          # Protected Admin Area
    /layout.tsx         # Contains Sidebar, Header, AuthCheck
    /page.tsx           # "Command Center" (Global overview)
    
    /events             # MODULE I
      /[eventId]
        /overview
        /map-editor     # Leaflet Map Editor
        /exhibitors
    
    /surveys            # MODULE II
      /builder
        /[surveyId]     # The Complex DnD Builder Page
      /results
        /[surveyId]
    
    /content            # MODULE III
      /scheduler        # FullCalendar View
      /inbox            # Unified WhatsApp Inbox
    
    /hypecards          # MODULE IV
      /studio           # The Visual Editor
        /[templateId]
      /gallery
```

-----

## **5. DATA FLOW DIAGRAM (FRONTEND)**

How the Frontend talks to the Backend and manages state.

```mermaid
graph TD
    subgraph "Client Browser"
        UserInteraction[User Drags Item]
        
        subgraph "Global State (Zustand)"
            BuilderStore[Builder Store\n(Draft Survey/Card)]
            UIStore[UI Store\n(Sidebar Open/Close)]
        end
        
        subgraph "Server State (TanStack Query)"
            EventsCache[Events List Cache]
            AnalyticsCache[Live Analytics Cache]
        end
        
        UserInteraction --> BuilderStore
        BuilderStore -->|Auto-Save Debounce| API_Client
    end

    subgraph "API Layer"
        API_Client[Axios/Fetch Wrapper]
        AuthInterceptor[Auth Token Interceptor]
    end

    API_Client --> AuthInterceptor
    AuthInterceptor -->|JSON| FastAPI[FastAPI Backend]
```

-----

## **6. CRITICAL UI COMPONENT: "THE CHAT SIMULATOR"**

Since this is a WhatsApp-first platform, the Admin needs to preview how things look on WhatsApp.
We will build a **Reusable Component: `<WhatsAppPreview />`**.

  * **Usage:**
      * In **Survey Builder:** Shows how the current question looks as a WhatsApp message.
      * In **Content Scheduler:** Previews the formatting of bold text (`*text*`) and emojis before scheduling.
  * **Props:**
      * `type`: 'text' | 'image' | 'button' | 'list'
      * `content`: string
      * `mediaUrl`: string
  * **Styling:** Hard-coded CSS to mimic the exact green bubbles, font size, and background of the WhatsApp mobile app.

-----

## **7. SECURITY & AUTHENTICATION (FRONTEND SIDE)**

  * **Auth System:** Integration with the Backend's JWT system.
  * **Middleware (`middleware.ts`):**
      * Checks for the `access_token` cookie on every route change.
      * If missing, redirects to `/login`.
  * **Role-Based Access Control (RBAC):**
      * We create a custom hook `usePermission(permissionName)`.
      * *Example:* If a "Standard Exhibitor" tries to access the "Global Heatmap", the UI component hides itself or shows a "Upgrade to Pro" banner.

-----
